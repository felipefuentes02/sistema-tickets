<!-- Header del componente -->
<app-header titulo="Dashboard Responsable"></app-header>

<ion-content>
  <!-- Refresher para actualizar datos deslizando hacia abajo -->
  <ion-refresher slot="fixed" (ionRefresh)="refrescar($event)">
    <ion-refresher-content
      pullingIcon="chevron-down-outline"
      pullingText="Desliza para actualizar"
      refreshingSpinner="crescent"
      refreshingText="Actualizando datos...">
    </ion-refresher-content>
  </ion-refresher>

  <div class="dashboard-container">
    <!-- Sección de información del usuario -->
    <div class="user-info-section ion-padding">
      <div class="welcome-message">
        <h2>Bienvenido, {{ obtenerNombreUsuario() }}</h2>
        <p>{{ obtenerDepartamento() }} - Responsable de Respuesta</p>
      </div>
      <div class="last-update">
        <ion-icon name="time-outline"></ion-icon>
        <span>Actualizado: {{ fechaActual | date:'dd/MM/yyyy HH:mm' }}</span>
      </div>
    </div>

    <!-- Contenido principal del dashboard -->
    <div class="main-content">
      <!-- Barra lateral de navegación -->
      <div class="navigation-sidebar">
        <h3>Navegación Rápida</h3>
        <div class="nav-buttons">
          <!-- Botón Solicitudes Abiertas -->
          <ion-button 
            expand="block" 
            fill="outline" 
            color="primary"
            class="nav-button"
            (click)="irASolicitudesAbiertas()">
            <ion-icon name="folder-open-outline" slot="start"></ion-icon>
            <div class="button-content">
              <span class="button-title">Solicitudes Abiertas</span>
            </div>
          </ion-button>

          <!-- Botón Solicitudes Cerradas -->
          <ion-button 
            expand="block" 
            fill="outline" 
            color="success"
            class="nav-button"
            (click)="irASolicitudesCerradas()">
            <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
            <div class="button-content">
              <span class="button-title">Solicitudes Cerradas</span>
            </div>
          </ion-button>

          <!-- Botón Solicitudes Pendientes -->
          <ion-button 
            expand="block" 
            fill="outline" 
            color="warning"
            class="nav-button"
            (click)="irASolicitudesPendientes()">
            <ion-icon name="hourglass-outline" slot="start"></ion-icon>
            <div class="button-content">
              <span class="button-title">Solicitudes Pendientes</span>
            </div>
          </ion-button>

          <!-- Botón Métricas Detalladas -->
          <ion-button 
            expand="block" 
            fill="outline" 
            color="tertiary"
            class="nav-button"
            (click)="irAMetricas()">
            <ion-icon name="analytics-outline" slot="start"></ion-icon>
            <div class="button-content">
              <span class="button-title">Métricas Detalladas</span>
            </div>
          </ion-button>
        </div>
      </div>

      <!-- Panel principal de métricas -->
      <div class="metrics-panel">
        <!-- Tarjetas de resumen -->
        <div class="summary-cards">
          <h3>Resumen del Departamento</h3>
          
          <!-- Fila superior de tarjetas -->
          <div class="cards-row">
            <!-- Total de Tickets -->
            <ion-card class="metric-card">
              <ion-card-header>
                <ion-card-subtitle>Total de Tickets</ion-card-subtitle>
                <ion-card-title>{{ obtenerTotalTickets() }}</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <ion-icon name="folder-outline" class="card-icon"></ion-icon>
                <p>Tickets en el sistema</p>
              </ion-card-content>
            </ion-card>

            <!-- Tickets Abiertos -->
            <ion-card class="metric-card status-open">
              <ion-card-header>
                <ion-card-subtitle>Tickets Abiertos</ion-card-subtitle>
                <ion-card-title>{{ resumen?.abiertas || 0 }}</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <ion-icon name="folder-open-outline" class="card-icon"></ion-icon>
                <p>Requieren atención</p>
              </ion-card-content>
            </ion-card>

            <!-- Tickets Cerrados -->
            <ion-card class="metric-card status-closed">
              <ion-card-header>
                <ion-card-subtitle>Tickets Cerrados</ion-card-subtitle>
                <ion-card-title>{{ resumen?.cerradas || 0 }}</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <ion-icon name="checkmark-circle-outline" class="card-icon"></ion-icon>
                <p>{{ obtenerPorcentajeCompletado() }}% del total</p>
              </ion-card-content>
            </ion-card>
          </div>

          <!-- Fila inferior de tarjetas -->
          <div class="cards-row">
            <!-- Tickets Vencidos -->
            <ion-card class="metric-card status-overdue">
              <ion-card-header>
                <ion-card-subtitle>Tickets Vencidos</ion-card-subtitle>
                <ion-card-title>{{ resumen?.vencidas || 0 }}</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <ion-icon name="alarm-outline" class="card-icon"></ion-icon>
                <p>{{ obtenerPorcentajeVencidos() }}% del total</p>
              </ion-card-content>
            </ion-card>

            <!-- Tiempo Promedio -->
            <ion-card class="metric-card">
              <ion-card-header>
                <ion-card-subtitle>Tiempo Promedio</ion-card-subtitle>
                <ion-card-title>{{ resumen?.tiempoPromedio || 0 }}h</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <ion-icon name="time-outline" class="card-icon"></ion-icon>
                <p>Tiempo de resolución</p>
              </ion-card-content>
            </ion-card>

            <!-- Satisfacción -->
            <ion-card class="metric-card" [ngClass]="'satisfaction-' + obtenerColorSatisfaccion()">
              <ion-card-header>
                <ion-card-subtitle>Satisfacción</ion-card-subtitle>
                <ion-card-title>{{ resumen?.satisfaccionPromedio || 0 }}/5</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <ion-icon name="star-outline" class="card-icon"></ion-icon>
                <p>Calificación promedio</p>
              </ion-card-content>
            </ion-card>
          </div>
        </div>

        <div class="charts-section" *ngIf="hayDatosDisponibles()">          
      </div>
        <!-- Mensaje cuando no hay datos -->
        <div class="no-data-message" *ngIf="!hayDatosDisponibles() && !cargando">
          <ion-icon name="analytics-outline"></ion-icon>
          <h3>No hay datos disponibles</h3>
          <p>Los gráficos se mostrarán cuando haya información suficiente.</p>
        </div>

        <!-- Indicador de carga -->
        <div class="loading-message" *ngIf="cargando">
          <ion-spinner name="crescent"></ion-spinner>
          <p>Cargando métricas del departamento...</p>
        </div>
      </div>
    </div>
  </div>
</ion-content>
